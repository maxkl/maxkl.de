---
title: "HDL Compiler"
subtitle: "Compiler for a self-invented hardware description language"
date: 2017-12-10T10:26:00+01:00
image: /images/hdl-compiler/code-and-sim.jpg
sourceLink: https://gitlab.com/maxkl2/hdl-compiler
featured: 1
---

After borrowing the ["Dragon Book"](https://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools) from the library, I was interested in trying to write my own compiler. Without ever having looked at VHDL or Verilog, I thought about creating a language to "program" simple digital circuits.

Initially written in C, it is now a Rust application that parses and compiles source code in this hardware description language which I developed myself. It produces files that can be read by my [LogicSimulator project]({{< relref "logic-simulator" >}}), a web-based simulator for digital circuits.

I have written an extensive README containing a lot more details and instructions on how to use the compiler which is available on GitLab together with the source code: [gitlab.com/maxkl2/hdl-compiler](https://gitlab.com/maxkl2/hdl-compiler).

This is how a simple 2-bit counter would be implemented:
```
sequential block Counter {
    clock rising_edge clk;
    out[2] y;

    y = y + 1#2;
}

block main {
    in clk;
    out[2] y;

    block Counter c;
    c.clk = clk;
    y = c.y;
}
```

I did not implement any sophisticated graph drawing algorithm, so the circuits are not clearly layed out or aesthetically pleasing. The circuit generated from the code above looks like this:

{{< figure src="/images/hdl-compiler/circuit_counter.png" width="300" >}}

## Example: 16-bit RISC CPU

To ensure the compiler's correct functionality and to test its limits (especially regarding optimizations) I have written a 16-bit RISC core in this hardware description language: [gitlab.com/maxkl2/hdl-cpu](https://gitlab.com/maxkl2/hdl-cpu). The programs it executes can either be written by hand or created using a simple assembler that I created for this purpose. This assembler, also written in Rust, can be found in the same repository as the core's HDL code.

This is a part of the circuit as generated by the compiler (yes, it's ugly):

{{< figure src="/images/hdl-compiler/cpu_zoom.gif" width="400" >}}

<br /><br />

Here you can see a counter program which also reacts to user input:

{{< gallery >}}
    {{< figure src="/images/hdl-compiler/asm_counter.png" caption="Assembly code" >}}
    {{< figure src="/images/hdl-compiler/cpu_counter.gif" caption="Executing the assembly code" >}}
{{< /gallery >}}

